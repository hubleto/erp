{% set dashboard = viewParams.defaultDashboard %}
{% set welcomeSplashImageUrl = config.welcomeSplashImageUrl ?? config.assetsUrl ~ "/images/logo-hubleto-text-horizontal.png" %}

<div
  class="border p-2 mb-2 flex gap-2 rounded"
  style="border-color:{{ user.DEFAULT_COMPANY.brand_color_primary ?? '#EEEEEE dark:border-slate-600' }}"
>
  {% if user.DEFAULT_COMPANY.logo != '' %}
    <div class="flex border-r items-center" style="border-color:{{ user.DEFAULT_COMPANY.brand_color_primary ?? '#EEEEEE dark:border-slate-600' }}">
      <img
        src="{{ config.uploadUrl }}/{{ user.DEFAULT_COMPANY.logo }}"
        class="max-h-32 max-w-32 m-8"
      />
    </div>
  {% endif %}
  <div class="m-8 dark:text-white">
    <h1 class="app-main-title">{{ translate('Welcome') }}, {{ user.first_name ?? user.email }}</h1>
    <div class="flex gap-2">
      {% if user.photo %}
        <div>
          <img
            src="{{ config.uploadUrl }}/{{ user.photo }}"
            class='max-w-24 max-h-24 rounded-xl'
          />
        </div>
      {% endif %}
      <div>
        <div><b>{{ user.DEFAULT_COMPANY.name }}</b></div>
        <div class="badge">{{ user.position }}</div>
        <div>{{ user.email }}</div>
        <div><a href="settings/my-account" class="text-primary">{{ translate('Edit profile') }}</a></div>
      </div>
    </div>
  </div>
</div>

{% if hubleto.appManager().isAppInstalled('Hubleto\\App\\Community\\Usage') %}
  {% set recentlyUsed = hubleto.getService('Hubleto\\App\\Community\\Usage\\Logger').getRecentlyUsedAppNamespaces() %}
  {% if recentlyUsed|length > 0 %}
    <div class="mb-2 dark:text-gray-200">
      <div><small>Recently used apps</small></div>
      <div>
        {% for appNamespace in recentlyUsed %}
          {% set manifest = hubleto.appManager().getApp(appNamespace).manifest %}
          <a href="{{ manifest.rootUrlSlug }}" class="btn btn-square btn-large btn-transparent">
            <span class="icon"><i class="{{ manifest.icon }}"></i></span>
            <span class="text">{{ manifest.nameTranslated }}</span>
          </a>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endif %}

<div class="mt-2">
  <app-dashboards-dashboard
    int:id-dashboard='{{ dashboard.id }}'
    json:panels='{{ dashboard.PANELS|json_encode|raw }}'
    bool:show-add-new-panel-button='true'
  ></app-dashboards-dashboard>
</div>

<div class="mx-auto pt-20">
  <img src="{{ welcomeSplashImageUrl }}" class="max-w-90 m-auto">
</div>
